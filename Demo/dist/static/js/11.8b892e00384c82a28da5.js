webpackJsonp([11],{UO8t:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={components:{SolidButton:s("Tftl").a},name:"mass-register",data:function(){return{conunts:0,addList:[{loseId:[],reason:"",imgUrl:[]}],options12:[],fileList:[],orderId:"",datas:{token:""},dialogImageUrl:"",dialogVisible:!1,vin:"",saveType:""}},methods:{removeMassLoss:function(t){this.RemoveValByIndex(this.addList,t)},RemoveValByIndex:function(t,e){t.splice(e,1)},addMassLoss:function(){var t={loseId:[],reason:"",imgUrl:[]};if(0!=this.addList.length){for(var e=0;e<this.addList.length;e++)if(0==this.addList[e].loseId.length)return void this.$message.error("请填写质损信息");for(e=0;e<this.addList.length;e++)if(0!=this.addList[e].loseId.length)return void this.addList.push(t)}else this.addList.push(t)},submits:function(){var t=this,e=[],s={id:null,parentId:"",losePositionId:"",reason:"",receiveId:this.orderId,loseImgUrl:""};0==this.addList.length&&e.push(s);for(var i=0;i<this.addList.length;i++){var a=[];0!=this.addList[i].imgUrl.length&&(this.addList[i].imgUrl[0].hasOwnProperty("response")?a.push(this.addList[i].imgUrl[0].response[0]):a.push(this.addList[i].imgUrl[0].url));var n={id:null,parentId:this.addList[i].loseId[0],losePositionId:this.addList[i].loseId[1],reason:this.addList[i].reason,receiveId:this.orderId,loseImgUrl:a.join(",")};e.push(n)}for(i=0;i<this.addList.length;i++)if(0==this.addList[i].loseId.length)return void this.$message.warning("请填写质损信息");this.$api.post("add"==this.saveType?"crm/sign/editVehicleLose":"crm/sign/updateVehicleLose",e,function(e){t.$message.success(e.repMsg),t.$router.push({name:"批量签收 ／ 批量签收"})},function(e){t.$message.error(e.repMsg)})},beforeAvatarUpload:function(t){console.log(t);var e="image/jpeg"===t.type,s="image/png"===t.type,i=t.size/1024/1024<1;return e||s||this.$confirm("上传图片暂时只支持JPG/PNG格式","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",callback:function(t){}}),i||this.$confirm("上传图片大小不能超过 1MB!","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",callback:function(t){}}),e||s&&i},pictureSuccess:function(t,e,s){this.$message.success("上传成功"),this.addList[this.conunts].imgUrl=s},getIndex:function(t){this.conunts=t},handleRemove:function(t,e){this.addList[this.conunts].imgUrl=[]},onExceed:function(t,e){this.$message({message:"最多允许上传1张图片",type:"error"})},submitUpload:function(){this.$refs.upload.submit()},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},close:function(){this.$router.push({name:"批量签收 ／ 批量签收"})},cancel:function(){this.$router.push({name:"批量签收 ／ 批量签收"})}},created:function(){var t=this;t.datas.token=t.$api.sGetObject("_user").token,t.orderId=this.$route.query.id,t.vin=this.$route.query.vin,t.addList=[],t.$api.post("crm/sign/echoVehicleLose",{receiveId:t.orderId},function(e){0==e.repData.length?(t.addList.push({id:null,reason:"",loseId:[],imgUrl:[]}),t.saveType="add"):(t.addList=e.repData,t.saveType="edit")},function(t){}),t.$api.post("crm/sign/displayLoseName",{},function(e){t.options12=e.repData},function(t){})}},a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[s("div",{staticClass:"header"},[s("span",{on:{click:t.close}},[s("i",{staticClass:"el-icon-circle-close-outline"}),t._v("关闭")]),t._v(" "),s("span",[t._v(t._s(t.vin))])]),t._v(" "),s("div",{staticClass:"contentParent"},[t._l(t.addList,function(e,i){return s("div",{staticClass:"contentBox"},[s("div",{staticClass:"block stylePadding"},[s("span",{staticClass:"demonstration"},[t._v("质损部位")]),t._v(" "),s("el-cascader",{attrs:{options:t.options12},model:{value:e.loseId,callback:function(s){t.$set(e,"loseId",s)},expression:"item.loseId"}}),t._v(" "),s("span",{staticStyle:{float:"right","padding-right":"40px"},on:{click:function(e){t.removeMassLoss(i)}}},[s("span",{staticClass:"icon-deletes"})])],1),t._v(" "),s("div",{staticClass:"stylePadding"},[s("span",{staticStyle:{display:"inline-block","line-height":"75px"}},[t._v("详细描述")]),t._v(" "),s("el-input",{attrs:{type:"textarea",rows:3,resize:"none",placeholder:"请输入内容"},model:{value:e.reason,callback:function(s){t.$set(e,"reason",s)},expression:"item.reason"}})],1),t._v(" "),s("div",{staticClass:"stylePadding"},[s("el-alert",{attrs:{title:"最多允许上传1张照片",closable:!1,type:"warning"}})],1),t._v(" "),s("div",{staticClass:"pictureStyle",on:{mouseover:function(e){t.getIndex(i)}}},[s("el-upload",{ref:"upload",refInFor:!0,attrs:{action:"http://10.108.2.29:28060/api/file/uploadController/upload","list-type":"picture-card",multiple:"",data:t.datas,limit:1,"auto-upload":!0,"file-list":t.addList[i].imgUrl,"on-success":t.pictureSuccess,"on-preview":t.handlePictureCardPreview,"on-exceed":t.onExceed,"on-remove":t.handleRemove,"before-upload":t.beforeAvatarUpload}},[s("i",{staticClass:"el-icon-plus"})]),t._v(" "),s("el-dialog",{attrs:{title:"查看图片",visible:t.dialogVisible,center:""},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)])}),t._v(" "),s("div",{staticClass:"addMassLoss"},[s("span",{on:{click:t.addMassLoss}},[t._v("添加质损部位")])])],2),t._v(" "),s("div",{staticClass:"footer"},[s("SolidButton",{attrs:{type:"solid",text:"提交"},on:{click:t.submits}}),t._v(" "),s("SolidButton",{attrs:{type:"hollow",text:"取消"},on:{click:t.cancel}})],1)])},staticRenderFns:[]};var n=s("VU/8")(i,a,!1,function(t){s("cfOQ")},"data-v-77534332",null);e.default=n.exports},cfOQ:function(t,e){}});
//# sourceMappingURL=11.8b892e00384c82a28da5.js.map