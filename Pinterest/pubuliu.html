<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css" media="screen">
		*{padding: 0;margin: 0;}
		#main{
		    width: 1000px;
		    margin: 0 auto;
		    position: relative;
		}
		.box{
		    display: inline-block;
		    float: left;
		    padding: 10px 0 0 10px;
		}
		.Pic{
		    border: 1px #ccc solid;
		    padding: 10px;
		    border-radius: 8px;
		}
		.Pic img{
		    width: 162px;
		}
	</style>
</head>
<body>
	<div id="main">
        <div class="box">
            <div class="Pic">
                <img src="images/article1.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article2.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article3.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article4.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article4.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article2.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article3.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article1.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article3.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article2.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article1.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article4.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article1.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article3.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article2.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article4.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article3.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article2.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article1.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article4.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article2.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article3.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article1.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article4.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article1.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article2.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article3.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article4.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article1.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article4.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article2.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article3.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article1.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article3.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article2.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article4.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article1.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article2.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article3.png" alt="" />
            </div>
        </div>
        <div class="box">
            <div class="Pic">
                <img src="images/article4.png" alt="" />
            </div>
        </div>
    </div>
</body>
<script>
    window.onload=function(){
        waterFall('main','box');
        var dataInt={
            "data":[{"src":"article1.png"},{"src":"article2.png"},{"src":"article3.png"},{"src":"article4.png"},{"src":"article1.png"},{"src":"article2.png"},{"src":"article3.png"},{"src":"article4.png"}]
        };
         
        /*滚动条滚动时触发的事件*/
        window.onscroll=function(){
            if(checkIsSlide()){  //结果返回是true则执行
                var omain=document.getElementById('main');
                /*添加div到页面上*/
                for(var l=0;l<dataInt.data.length;l++){ 
                    var box=document.createElement('div');
                    box.className="box";
                    omain.appendChild(box);
                    var pic=document.createElement('div');
                    pic.className='Pic';
                    box.appendChild(pic);
                    var oimg=document.createElement('img');
                    oimg.src="images/"+dataInt.data[l].src;
                    pic.appendChild(oimg);
                }
                waterFall('main','box');  //新添加的div都要重新执行waterFall方法，以实现瀑布流效果
            }
        }
    }
    /*实现瀑布流效果，多栏布局*/
    function waterFall(parent,pid){   //传两个参数，父元素parent和子元素pid
        var oparent=document.getElementById(parent);   //获取父元素
        var opid=getClass(oparent,pid);   //获取父元素下的classname为pid的所有子元素
        var cols=Math.floor(oparent.offsetWidth/opid[0].offsetWidth);  //父元素宽度/一个子元素的宽度，即一行的列数
        var arrH=[];   //存放每一列的高度的数组
        for(var j=0;j<opid.length;j++){
            if(j<cols){  
                arrH.push(opid[j].offsetHeight);//把第一行的高度都放进数组中
            }else{   //第二行开始
                var minH=Math.min.apply(null,arrH);   //计算arrH的最小值
                var Index=getHIndex(arrH,minH);  //使用getHIndex方法获取最小值的index值
                /*把之后的div放到最小值div的下方*/
                opid[j].style.position='absolute'; 
                opid[j].style.top=minH+'px';
                opid[j].style.left=opid[0].offsetWidth*Index+'px';
                arrH[Index]+=opid[j].offsetHeight; //数组中的最小值加上已放在下方的div的高度值并重新循环
            }
        }
         
    }
 
    /*获取父元素下的classname为cls的所有元素*/
    function getClass(parent,cls){
        var obj=parent.getElementsByTagName('*');
        var Clsarr=[];
        for(var i=0;i<obj.length;i++){
            if(obj[i].className==cls){
                Clsarr.push(obj[i]);
            }
        }
        return Clsarr;
    }
    /*获取arr数组中的最小值minH的Index值*/
    function getHIndex(arr,minH){
        for(var k=0;k<arr.length;k++){
            if(arr[k]==minH){
                return k;
            }
        }
    }
    /*判断当前滚动的高度时候大于最后的div出现在底部的高度值,即是否要加载*/
    function checkIsSlide(){
        var omain=document.getElementById('main');
        var obox=getClass(omain,'box');
        var lastTop=obox[obox.length-1].offsetTop+Math.floor(obox[obox.length-1].offsetHeight/2);
        var scrollTop=document.body.scrollTop||document.documentElement.scrollTop;
        var documentH=document.documentElement.clientHeight;
        return (lastTop)<(scrollTop+documentH)?true:false;
    }
</script>
</html>